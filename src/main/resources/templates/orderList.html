<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Product List</title>
    <link rel="stylesheet" type="text/css" th:href="@{/styles.css}">
</head>
<body>
<th:block th:insert="~{/_header}"></th:block>
<th:block th:insert="~{/_menu}"></th:block>
<div class="page-title">Order List</div>
<div>Total Order Count: <span th:utext="${paginationPages.size()}"></span></div>
<table style="width:100%">
    <tr>
        <th>Order Num</th>
        <th>Order Date</th>
        <th>Customer Name</th>
        <th>Status</th>
        <th>Amount</th>
        <th>View</th>
        <th th:if="${isManager || isCustomer}">Update Status</th>
    </tr>
    <tr th:each="orderInfo : ${paginationPages}">
        <td th:utext="${orderInfo.orderNum}"></td>
        <td th:utext="${#dates.format(orderInfo.orderDate,'dd-MM-yyyy HH:mm')}"></td>
        <td th:utext="${orderInfo.name}"></td>
        <td th:utext="${orderInfo.status}"></td>
        <td style="color:red;" th:utext="${#numbers.formatDecimal(orderInfo.amount,3,2,'COMMA')}">
        </td>
        <td><a th:href="@{|/admin/order?orderId=${orderInfo.id}|}">View</a></td>

        <!-- Nếu là người quản lý thì hiển thị form cập nhật trạng thái -->
        <td th:if="${isManager || isCustomer}">
            <form th:action="@{/admin/updateOrderStatus}" method="post">
                <input type="hidden" name="orderId" th:value="${orderInfo.id}" />

                <select name="status">
                    <!-- Nếu là Manager, chỉ hiển thị các trạng thái CONFIRMED và SHIPPED -->
                    <option th:if="${isManager && orderInfo.status == 'PENDING_CONFIRMATION'}"
                            value="CONFIRMED" th:selected="${orderInfo.status == 'CONFIRMED'}">Confirmed</option>
                    <option th:if="${isManager && orderInfo.status == 'CONFIRMED'}"
                            value="SHIPPED" th:selected="${orderInfo.status == 'SHIPPED'}">Shipped</option>

                    <!-- Nếu là Customer và trạng thái hiện tại là SHIPPED, cho phép chuyển thành DELIVERED -->
                    <option th:if="${isCustomer && orderInfo.status == 'SHIPPED'}"
                            value="DELIVERED" th:selected="${orderInfo.status == 'DELIVERED'}">Delivered</option>
                </select>
                <button type="submit">Update</button>
            </form>
        </td>
    </tr>
</table>

<div>
    <ul class="pagination">
        <!-- Previous Page Link -->
        <li th:if="${currentPage > 1}">
            <a th:href="@{/orderList(page=${currentPage - 1}, name=${searchName})}">Previous</a>
        </li>

        <!-- Page Number Links -->
        <li th:each="pageNumber : ${#numbers.sequence(1, totalPages)}"
            th:classappend="${pageNumber == currentPage} ? 'active' : ''">
            <a th:href="@{/orderList(page=${pageNumber}, name=${searchName})}" th:text="${pageNumber}"></a>
        </li>

        <!-- Next Page Link -->
        <li th:if="${currentPage < totalPages}">
            <a th:href="@{/orderList(page=${currentPage + 1}, name=${searchName})}">Next</a>
        </li>
    </ul>
</div>
<th:block th:insert="~{/_footer}"></th:block>
</body>
</html>